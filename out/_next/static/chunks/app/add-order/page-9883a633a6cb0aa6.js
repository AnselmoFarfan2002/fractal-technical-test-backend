(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[367],{4728:function(e,t,n){Promise.resolve().then(n.bind(n,2816))},1363:function(e,t,n){"use strict";n.d(t,{n:function(){return i}});let i=""},2816:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return k}});var i=n(7437),l=n(1363),r=n(8874),s=n(3226),a=n(9050),d=n(1975),c=n(4249),o=n(2265),u=n(4837),h=n(3216),f=n(2653),x=n(4033),m=n(6959),j=n(4749),Z=n(3528),p=n(6820),P=n.n(p),g=n(3027),b=n(5242),S=n(2320),C=n(819),v=n(8502),y=n(4309);function w(e){let{isEdit:t,open:n,setOpen:l,products:c,messageModal:o,handleAddToList:u,selectedProduct:h,setSelectedProduct:f,quantity:x,setQuantity:m,itemList2Edit:j=null,setItemList2Edit:Z,handleChangeItemList:p}=e;function P(){l(!1),setTimeout(()=>{Z(null),m(0),f(null)},500)}return(0,i.jsx)(g.Z,{open:n,onClose:P,children:(0,i.jsx)(b.Z,{children:(0,i.jsxs)(r.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(r.ZP,{item:!0,children:(0,i.jsx)(s.Z,{variant:"h6",children:j?"Edit product from list":"Add product to list"})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,children:(0,i.jsxs)(S.Z,{fullWidth:!0,children:[(0,i.jsx)(C.Z,{sx:{bgcolor:"white"},children:"Product"}),(0,i.jsx)(v.Z,{disabled:!!j,value:h,onChange:e=>f(e.target.value),children:c.filter(e=>t||e.visible).map((e,t)=>(0,i.jsx)(y.Z,{value:e,children:"".concat(e.name,": $").concat(e.price)},e.id))})]})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,children:(0,i.jsx)(d.Z,{type:"number",label:"Quantity",fullWidth:!0,value:x,onChange:e=>m(e.target.value)})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,children:(0,i.jsx)(s.Z,{variant:"body2",color:"error",children:o})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,children:(0,i.jsx)(a.Z,{variant:"contained",color:"info",fullWidth:!0,sx:{height:"100%"},onClick:j?function(){p(j.id),P()}:u,children:j?"Save changes":"Add to list"})})]})})})}function k(){let[e,t]=(0,o.useState)(!1),[n,p]=(0,o.useState)(null),[g,b]=(0,o.useState)(!1),[S,C]=(0,o.useState)([]),[v,y]=(0,o.useState)(null),[k,E]=(0,o.useState)(null),[N,O]=(0,o.useState)(0),[D,A]=(0,o.useState)(""),[q,T]=(0,o.useState)(new Date().toISOString()),[W,I]=(0,o.useState)([]),[R,_]=(0,o.useState)(0),[L,F]=(0,o.useState)(""),[U,G]=(0,o.useState)("");(0,o.useEffect)(()=>{fetch(l.n+"/api/product").then(e=>e.json()).then(e=>C(e))},[]),(0,o.useEffect)(()=>{O(W.reduce((e,t)=>e+=Number(t.total),0))},[W]),(0,o.useEffect)(()=>{new URL(window.location.href).searchParams.get("id")&&t(!0)},[]),(0,o.useEffect)(()=>{if(!e&&S.length<1)return;let t=new URL(window.location.href).searchParams.get("id");p(t),fetch(l.n+"/api/order/"+t).then(e=>e.json()).then(e=>{A(e.number),T(e.date),I(e.itemList.map((e,t)=>({...S.filter(t=>t.id==e.ProductId)[0],...e,num:t+1})))})},[e,S]);let Q=function(e){let{handleDelete:t,handleEdit:n}=e;return[{field:"num",headerName:"#",flex:1},{field:"name",headerName:"Name",flex:1},{field:"price",headerName:"Unit Price",flex:1},{field:"quantity",headerName:"Quantity",flex:1},{field:"total",headerName:"Total",flex:1},{field:"options",headerName:"Option",flex:1,sortable:!1,renderCell:e=>{let{row:l}=e;return(0,i.jsxs)(i.Fragment,{children:[n&&(0,i.jsx)(f.Z,{onClick:()=>n(l),children:(0,i.jsx)(u.Z,{})}),(0,i.jsx)(f.Z,{onClick:()=>t(l.id),children:(0,i.jsx)(h.Z,{color:"error"})})]})}}]}({handleDelete:async function(e){F(""),(await P().fire({title:"Are you sure?",text:"This action is will delete the item from the list",icon:"question",showCancelButton:!0})).isConfirmed&&I(W.filter(t=>t.id!=e))},...e?{handleEdit:function(e){b(!0),_(e.quantity),y(S.find(t=>t.id==e.ProductId)),E(e)}}:{}}),$=(0,x.useRouter)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r.ZP,{container:!0,spacing:3,children:[(0,i.jsxs)(r.ZP,{item:!0,xs:12,children:[(0,i.jsx)(s.Z,{variant:"h3",children:e?"Edit Order":"Add Order"}),(0,i.jsx)(a.Z,{onClick:()=>$.push("/my-orders"),startIcon:(0,i.jsx)(m.Z,{}),children:"Go back"})]}),(0,i.jsx)(r.ZP,{item:!0,xs:6,children:(0,i.jsx)(d.Z,{disabled:!0,label:"Date",value:new Date(q).toLocaleDateString(),fullWidth:!0})}),(0,i.jsx)(r.ZP,{item:!0,xs:6,children:(0,i.jsx)(d.Z,{fullWidth:!0,value:D,label:"# Order",onChange:e=>A(e.target.value)})}),(0,i.jsx)(r.ZP,{item:!0,xs:6,children:(0,i.jsx)(d.Z,{disabled:!0,label:"# products",fullWidth:!0,value:W.length})}),(0,i.jsx)(r.ZP,{item:!0,xs:6,children:(0,i.jsx)(d.Z,{disabled:!0,label:"Final Price",fullWidth:!0,value:N})}),!e&&(0,i.jsx)(r.ZP,{item:!0,xs:12,children:(0,i.jsx)(a.Z,{variant:"contained",onClick:()=>b(!0),startIcon:(0,i.jsx)(j.Z,{}),children:"ADD PRODUCT"})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,children:(0,i.jsx)(c._$,{columns:Q,rows:W,disableColumnFilter:!0,disableColumnMenu:!0,disableColumnSelector:!0,hideFooterPagination:!0,disableRowSelectionOnClick:!0})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,children:(0,i.jsx)(s.Z,{variant:"h6",color:"error",children:L})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,children:(0,i.jsx)(a.Z,{variant:"contained",color:"success",fullWidth:!0,sx:{height:"100%"},onClick:function(){if(!D){F("# Order is required");return}if(0==W.length){F("Products in list are required");return}F(""),fetch(l.n+"/api/order"+(e?"/"+n:""),{method:e?"PUT":"POST",body:JSON.stringify({number:D,date:q,items:W.length,itemList:W}),headers:{"Content-type":"application/json"}}).then(e=>{e.ok&&$.push("/my-orders")})},startIcon:(0,i.jsx)(Z.Z,{}),children:e?"SAVE CHANGES":"ADD ORDER"})})]}),(0,i.jsx)(w,{open:g,setOpen:b,products:S,messageModal:U,handleAddToList:function(){if(!v||R<=0){G("Select a product and input a quantity");return}if(W.filter(e=>e.name==v.name).length>0){G("This product is alreay in the list");return}G(""),F(""),I([...W.slice(),{num:W.length+1,...e?{}:{id:W.length+1},product:v.id,name:v.name,price:v.price,quantity:R,total:v.price*R}]),b(!1)},selectedProduct:v,setSelectedProduct:y,quantity:R,setQuantity:_,isEdit:e,itemList2Edit:k,setItemList2Edit:E,handleChangeItemList:function(e){let t=W.slice(),n=t.find(t=>t.id==e);n.quantity=R,n.total=n.price*n.quantity,I(t)}})]})}}},function(e){e.O(0,[461,944,320,251,971,938,744],function(){return e(e.s=4728)}),_N_E=e.O()}]);